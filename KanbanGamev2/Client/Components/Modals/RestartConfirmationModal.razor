@using KanbanGamev2.Client.Services

<style>
    .restart-modal {
        border-radius: 16px;
        border: none;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        overflow: hidden;
    }

    .restart-modal-header {
        background: #ffebee;
        border: none;
        border-bottom: 1px solid #f44336;
        padding: 1.5rem;
        color: #212529;
    }

    .restart-modal-body {
        padding: 1.5rem;
    }

    .restart-modal-footer {
        border: none;
        padding: 1.5rem;
        border-top: 1px solid #e9ecef;
        background-color: #f8f9fa;
    }

    .restart-alert {
        border-radius: 8px;
        border: 1px solid #ffc107;
        background: #fff3cd;
    }

    .restart-btn {
        border-radius: 8px;
        font-weight: 600;
        padding: 0.5rem 1rem;
        transition: all 0.2s ease;
        border: none;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .restart-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .restart-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }
</style>

<div class="modal fade @(IsVisible ? "show" : "")" style="display: @(IsVisible ? "block" : "none");" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content restart-modal">
            <div class="modal-header restart-modal-header">
                <h5 class="modal-title fw-bold">
                    <i class="oi oi-warning"></i> Confirm Game Restart
                </h5>
                <button type="button" class="btn-close" @onclick="CloseModal"></button>
            </div>
            <div class="modal-body restart-modal-body">
                <div class="alert alert-warning restart-alert" role="alert">
                    <h6 class="alert-heading fw-bold">
                        <i class="oi oi-warning"></i> Warning: This action cannot be undone!
                    </h6>
                    <p class="mb-2">
                        Are you sure you want to restart the game? This will:
                    </p>
                    <ul class="mb-0 mt-2" style="padding-left: 1.5rem;">
                        <li>Reset all game progress to day 1</li>
                        <li>Reset money to $10,000</li>
                        <li>Move all features and tasks back to backlog</li>
                        <li>Reset all employee assignments</li>
                        <li>Clear all achievements and money transactions</li>
                    </ul>
                </div>
                <p class="text-muted small mt-3">
                    <strong>Note:</strong> All connected players will see this restart and their boards will be refreshed automatically.
                </p>
            </div>
            <div class="modal-footer restart-modal-footer">
                <button type="button" class="btn btn-secondary restart-btn" @onclick="CloseModal" disabled="@IsRestarting">
                    <i class="oi oi-x"></i> Cancel
                </button>
                <button type="button" class="btn btn-danger restart-btn" @onclick="ConfirmRestart" disabled="@IsRestarting">
                    @if (IsRestarting)
                    {
                        <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                        <span>Restarting...</span>
                    }
                    else
                    {
                        <i class="oi oi-reload"></i>
                        <span>Yes, Restart Game</span>
                    }
                </button>
            </div>
        </div>
    </div>
</div>

@if (IsVisible)
{
    <div class="modal-backdrop fade show" style="backdrop-filter: blur(4px);"></div>
}

@code {
    [Parameter] public bool IsVisible { get; set; }
    [Parameter] public EventCallback<bool> IsVisibleChanged { get; set; }
    [Parameter] public EventCallback OnRestartConfirmed { get; set; }

    private bool IsRestarting { get; set; } = false;

    private async Task CloseModal()
    {
        if (!IsRestarting)
        {
            IsVisible = false;
            await IsVisibleChanged.InvokeAsync(false);
        }
    }

    private async Task ConfirmRestart()
    {
        IsRestarting = true;
        StateHasChanged();

        try
        {
            await OnRestartConfirmed.InvokeAsync();
        }
        finally
        {
            IsRestarting = false;
            StateHasChanged();
        }
    }
} 