@page "/backend-board"
@using KanbanGame.Shared
@using KanbanGamev2.Client.Services
@using KanbanGamev2.Client.Components
@inject IEmployeeService EmployeeService
@inject ITaskService TaskService

<PageTitle>Backend Development Board</PageTitle>

<link href="css/kanban.css" rel="stylesheet" />

<div class="container-fluid">
    <KanbanBoard 
        Title="Backend Development Board"
        Description="Track backend tasks and employee assignments through the development process"
        Columns="@backendColumns"
        OnCardClick="@OnCardClick" />
</div>

@code {
    private List<KanbanBoard.KanbanColumnData> backendColumns = new();

    protected override async Task OnInitializedAsync()
    {
        await LoadData();
        OrganizeColumns();
    }

    private async Task LoadData()
    {
        await EmployeeService.GetEmployees();
        await TaskService.GetTasks();
    }

    private void OrganizeColumns()
    {
        backendColumns = new List<KanbanBoard.KanbanColumnData>
        {
            new KanbanBoard.KanbanColumnData
            {
                Title = "Backlog",
                Cards = GetCardsByColumn("backend-backlog")
            },
            new KanbanBoard.KanbanColumnData
            {
                Title = "Analysis",
                Cards = GetCardsByColumn("backend-analysis")
            },
            new KanbanBoard.KanbanColumnData
            {
                Title = "Development Waiting",
                Cards = GetCardsByColumn("backend-dev-waiting")
            },
            new KanbanBoard.KanbanColumnData
            {
                Title = "Development Doing",
                Cards = GetCardsByColumn("backend-dev-doing")
            },
            new KanbanBoard.KanbanColumnData
            {
                Title = "Testing Waiting",
                Cards = GetCardsByColumn("backend-test-waiting")
            },
            new KanbanBoard.KanbanColumnData
            {
                Title = "Testing Doing",
                Cards = GetCardsByColumn("backend-test-doing")
            },
            new KanbanBoard.KanbanColumnData
            {
                Title = "Done",
                Cards = GetCardsByColumn("backend-done")
            }
        };
    }

    private List<Card> GetCardsByColumn(string columnId)
    {
        var cards = new List<Card>();
        
        // Add tasks for this column
        var tasks = TaskService.Tasks.Where(t => t.ColumnId == columnId).ToList();
        cards.AddRange(tasks);
        
        // Add employees for this column
        var employees = EmployeeService.Employees.Where(e => e.ColumnId == columnId).ToList();
        cards.AddRange(employees);
        
        return cards;
    }

    private void OnCardClick(Card card)
    {
        // Handle card click - will be enhanced with drag and drop later
        Console.WriteLine($"Card clicked: {card.Title}");
    }
} 