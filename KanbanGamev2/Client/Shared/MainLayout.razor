@inherits LayoutComponentBase
@using KanbanGamev2.Client.Components
@inject KanbanGamev2.Client.Services.ISignalRService SignalRService
@implements IDisposable

<div class="page">
    <GlobalLoader IsVisible="@IsLoading" Title="@LoaderTitle" Message="@LoaderMessage" />
    <div class="sidebar">
        <NavMenu />
    </div>

    <main>
        <div class="top-row px-4">
            <a href="https://docs.microsoft.com/aspnet/" target="_blank">About</a>
        </div>

        <article class="content px-4">
            @Body
        </article>
    </main>
</div>

@code {
    private bool IsLoading { get; set; } = false;
    private string LoaderTitle { get; set; } = "Loading...";
    private string LoaderMessage { get; set; } = "Please wait...";

    protected override void OnInitialized()
    {
        SignalRService.NextDayStarted += OnNextDayStarted;
    }

    private void OnNextDayStarted()
    {
        IsLoading = true;
        LoaderTitle = "Advancing to Next Day";
        LoaderMessage = "Preparing the game for the next day...";
        StateHasChanged();

        // Hide loader after 3 seconds
        Task.Delay(3000).ContinueWith(_ =>
        {
            IsLoading = false;
            StateHasChanged();
        });
    }

    public void Dispose()
    {
        SignalRService.NextDayStarted -= OnNextDayStarted;
    }
}
